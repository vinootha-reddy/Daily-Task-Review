{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="layout">

  <!-- Sidebar -->
  <aside class="sidebar">
    <h3>All Days</h3>

    {% for d in all_days %}
      <a href="{% url 'day_view' d.id %}"
         class="day-link {% if d.id == day.id %}active-day{% endif %}">
        {{ d.date }}

        {% if d.is_active %}<span class="dot blue"></span>{% endif %}
        {% if d.status == 'OPEN' and not d.is_active %}<span class="dot yellow"></span>{% endif %}
        {% if d.status == 'CLOSED' %}<span class="dot gray"></span>{% endif %}
      </a>
    {% endfor %}
  </aside>

  <!-- Main -->
  <main class="main">

    <header>
      <h1>{{ day.date|date:"F j, Y" }}</h1>
      <span class="badge active">Active Day</span>
    </header>

    <!-- ADD TASK -->
    <form method="post" action="{% url 'add_task' %}" class="add-form">
      {% csrf_token %}
      <input type="text" name="title" placeholder="Add a new task..." required autofocus>
      <button type="submit">Add Task</button>
    </form>

    <div class="columns">

      <!-- INCOMPLETE -->
      <section>
        <h3>In Progress</h3>

        {% for task in incomplete_tasks %}
          <div class="task">
            <span>{{ task.title }}</span>

            <div class="actions">
              <form method="post" action="{% url 'toggle_task' task.id %}">
                {% csrf_token %}
                <button type="submit" class="done">Complete</button>
              </form>

              <form method="post" action="{% url 'delete_task' task.id %}">
                {% csrf_token %}
                <button type="submit" class="delete">Ã—</button>
              </form>
            </div>
          </div>
        {% empty %}
          <p class="muted">No pending tasks. Add one above to get started.</p>
        {% endfor %}
      </section>

      <!-- COMPLETED -->
      <section>
        <h3>Completed</h3>

        {% for task in completed_tasks %}
          <div class="task completed">
            <span>{{ task.title }}</span>

            <form method="post" action="{% url 'toggle_task' task.id %}">
              {% csrf_token %}
              <button type="submit" class="undo">Reopen</button>
            </form>
          </div>
        {% empty %}
          <p class="muted">Completed tasks will appear here</p>
        {% endfor %}
      </section>

    </div>

    <!-- CLOSE DAY -->
    <form method="post" action="{% url 'close_active_day' %}" class="close-box">
      {% csrf_token %}
      <h3>Close Active Day</h3>
      <p class="muted" style="margin-bottom: 12px;">Select tasks to carry forward to the next day:</p>

      {% for task in incomplete_tasks %}
        <label>
          <input type="checkbox" name="carry_tasks" value="{{ task.id }}">
          {{ task.title }}
        </label>
      {% endfor %}

      <button type="submit" class="close-day">Close Day</button>
    </form>

  </main>
</div>

{% endblock %}
    